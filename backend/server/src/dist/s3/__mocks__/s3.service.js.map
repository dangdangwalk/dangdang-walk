{"version":3,"sources":["../../../src/s3/__mocks__/s3.service.ts"],"sourcesContent":["import { ForbiddenException } from '@nestjs/common';\n\nimport { generateUuid } from '../../utils/hash.util';\nimport { PresignedUrlInfo } from '../types/presigned-url-info.type';\n\nexport const MockS3Service = {\n    createPresignedUrlWithClientForPut: jest.fn((userId: number, type: string[]): PresignedUrlInfo[] => {\n        const filenameArray = type.map((curType) => `${userId}/${generateUuid()}.${curType}`);\n        return filenameArray.map((curFileName) => ({\n            filename: curFileName,\n            url: 'https://aws.s3/' + curFileName,\n        }));\n    }),\n\n    deleteObjects: jest.fn((userId: number, filenames: string[]) => {\n        for (const curFilename of filenames) {\n            if (curFilename.startsWith('default/')) return true;\n\n            if (parseInt(curFilename.split('/')[0]) !== userId) {\n                throw new ForbiddenException(`User ${userId} is not owner of the file ${curFilename}`);\n            }\n        }\n    }),\n\n    deleteSingleObject: jest.fn(),\n\n    deleteObjectFolder: jest.fn(),\n};\n"],"names":["MockS3Service","createPresignedUrlWithClientForPut","jest","fn","userId","type","filenameArray","map","curType","generateUuid","curFileName","filename","url","deleteObjects","filenames","curFilename","startsWith","parseInt","split","ForbiddenException","deleteSingleObject","deleteObjectFolder"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";+BAKaA;;;eAAAA;;;wBALsB;0BAEN;AAGtB,MAAMA,gBAAgB;IACzBC,oCAAoCC,KAAKC,EAAE,CAAC,CAACC,QAAgBC;QACzD,MAAMC,gBAAgBD,KAAKE,GAAG,CAAC,CAACC,UAAY,CAAC,EAAEJ,OAAO,CAAC,EAAEK,IAAAA,sBAAY,IAAG,CAAC,EAAED,QAAQ,CAAC;QACpF,OAAOF,cAAcC,GAAG,CAAC,CAACG,cAAiB,CAAA;gBACvCC,UAAUD;gBACVE,KAAK,oBAAoBF;YAC7B,CAAA;IACJ;IAEAG,eAAeX,KAAKC,EAAE,CAAC,CAACC,QAAgBU;QACpC,KAAK,MAAMC,eAAeD,UAAW;YACjC,IAAIC,YAAYC,UAAU,CAAC,aAAa,OAAO;YAE/C,IAAIC,SAASF,YAAYG,KAAK,CAAC,IAAI,CAAC,EAAE,MAAMd,QAAQ;gBAChD,MAAM,IAAIe,0BAAkB,CAAC,CAAC,KAAK,EAAEf,OAAO,0BAA0B,EAAEW,YAAY,CAAC;YACzF;QACJ;IACJ;IAEAK,oBAAoBlB,KAAKC,EAAE;IAE3BkB,oBAAoBnB,KAAKC,EAAE;AAC/B"}