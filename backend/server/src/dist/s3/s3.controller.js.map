{"version":3,"sources":["../../src/s3/s3.controller.ts"],"sourcesContent":["import { Body, Controller, Delete, HttpCode, ParseArrayPipe, Post } from '@nestjs/common';\n\nimport { FileType, FileTypeValidationPipe } from './pipes/file-type-validation.pipe';\nimport { S3Service } from './s3.service';\n\nimport { PresignedUrlInfo } from './types/presigned-url-info.type';\n\nimport { AccessTokenPayload } from '../auth/token/token.service';\nimport { User } from '../users/decorators/user.decorator';\n\n@Controller('/images')\nexport class S3Controller {\n    constructor(private readonly s3Service: S3Service) {}\n\n    @Post('/presigned-url')\n    @HttpCode(200)\n    async presignedUrl(\n        @User() user: AccessTokenPayload,\n        @Body(new FileTypeValidationPipe()) type: FileType[],\n    ): Promise<PresignedUrlInfo[]> {\n        return await this.s3Service.createPresignedUrlWithClientForPut(user.userId, type);\n    }\n\n    @Delete()\n    @HttpCode(204)\n    async delete(\n        @User() { userId }: AccessTokenPayload,\n        @Body(new ParseArrayPipe({ items: String, separator: ',' })) filenames: string[],\n    ) {\n        await this.s3Service.deleteObjects(userId, filenames);\n    }\n}\n"],"names":["S3Controller","presignedUrl","user","type","s3Service","createPresignedUrlWithClientForPut","userId","delete","filenames","deleteObjects","constructor","Post","HttpCode","User","Body","FileTypeValidationPipe","Delete","ParseArrayPipe","items","String","separator","Controller"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";+BAWaA;;;eAAAA;;;wBAX4D;wCAExB;2BACvB;8BAIS;+BACd;;;;;;;;;;;;;;;AAGd,IAAA,AAAMA,eAAN,MAAMA;IAGT,MAEMC,aACF,AAAQC,IAAwB,EAChC,AAAoCC,IAAgB,EACzB;QAC3B,OAAO,MAAM,IAAI,CAACC,SAAS,CAACC,kCAAkC,CAACH,KAAKI,MAAM,EAAEH;IAChF;IAEA,MAEMI,OACF,AAAQ,EAAED,MAAM,EAAsB,EACtC,AAA6DE,SAAmB,EAClF;QACE,MAAM,IAAI,CAACJ,SAAS,CAACK,aAAa,CAACH,QAAQE;IAC/C;IAlBAE,YAAY,AAAiBN,SAAoB,CAAE;aAAtBA,YAAAA;IAAuB;AAmBxD;;IAjBKO,IAAAA,YAAI,EAAC;IACLC,IAAAA,gBAAQ,EAAC;IAELC,aAAAA,IAAAA,mBAAI;IACJC,aAAAA,IAAAA,YAAI,EAAC,IAAIC,8CAAsB;;;eADlB,gCAAkB,4BAAlB,gCAAkB;;;;GAN3Bf;;IAYRgB,IAAAA,cAAM;IACNJ,IAAAA,gBAAQ,EAAC;IAELC,aAAAA,IAAAA,mBAAI;IACJC,aAAAA,IAAAA,YAAI,EAAC,IAAIG,sBAAc,CAAC;QAAEC,OAAOC;QAAQC,WAAW;IAAI;;;eADrC,gCAAkB,4BAAlB,gCAAkB;;;;GAfjCpB;AAAAA;IADZqB,IAAAA,kBAAU,EAAC;;;eAEgC,oBAAS,4BAAT,oBAAS;;GADxCrB"}